{% extends 'layout.html.twig' %}

    {% block title %}
    Register to {{ parent() }}
    {% endblock %}
{% block header %}
<style>
    /* The message box is shown when the user clicks on the password field */
#message, #confirmMessage {
    display:none;
    color: #000;
    position: relative;
    padding: 10px;
    margin-top: 10px;
  }
  
  #message p, #confirmMessage p {
    padding: 5px 20px;
    font-size: 14px;
  }
  
  /* Add a green text color and a checkmark when the requirements are right */
  .valid {
    color: green;
  }
  
  .valid:before {
    position: relative;
    left: -20px;
    content: "\02714";
  }
  
  /* Add a red text color and an "x" icon when the requirements are wrong */
  .invalid {
    color: red;
  }
  
  .invalid:before {
    position: relative;
    left: -20px;
    content: "\02715";
  }
</style>
{% endblock %}
{% block content %}
<div class="about-area area-padding " style="background-color: rgb(190, 215, 226);">

    <div class="container" style="margin-top: 25px;">
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
              <div class="section-headline text-center">
                <h2>Create New <span>So</span>Pay Account !</h2>
              </div>
            </div>
          </div>
        <div class="card o-hidden border-0 shadow-lg my-5">
            <div class="card-body p-0">
                <!-- Nested Row within Card Body -->
                <div class="row">
                    <div class="col-lg-3 d-none d-lg-block bg-register-image"></div>
                    <div class="col-lg-6">
                        <div class="p-5">
                            <div class="text-center">
                                <h1 class="h4 text-gray-900 mb-4">Your ready</h1>
                                <h4 id="errorTag" style="display: none;"></h4>
                            </div>
                            <form class="user" id="register">
                                <div class="form-group">
                                    <select class="form-control " id="typeUser">
                                    <option selected disabled>Select Account Type</option>
                                    <option name="typeUser" value="PERSONNAL" required>Personal Account</option>
                                    <option name="typeUser" value="PROFESSIONAL">Profesional Account</option>
                                    </select>
                                </div>
                                <div class="form-group row">
                                    <div class="col-sm-6 mb-3 mb-sm-0">
                                        <input type="text" class="form-control form-control-user" id="username"
                                            placeholder="Username" required>
                                    </div>
                                    <div class="col-sm-6">
                                        <input type="number" class="form-control form-control-user" id="contact"
                                            placeholder="Contact" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="email" class="form-control form-control-user" id="email"
                                        placeholder="Email Address" required>
                                </div>
                                <div class="form-group row">
                                    <div class="col-sm-6 mb-3 mb-sm-0">
                                        <input type="password" class="form-control form-control-user"
                                            id="password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}" title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters" placeholder="Password" required>
                                    </div>
                                    <div class="col-sm-6">
                                        <input type="password" class="form-control form-control-user"
                                            id="passConfirm" placeholder="Repeat Password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}" required>
                                    </div>
                                </div>
                                <div class="form-group row ">
                                    <div style="width: 80%; margin-left:10%" id="message">
                                        <h5>Password must contain the following:</h5>
                                        <p id="letter" class="invalid">A <b>lowercase</b> letter</p>
                                        <p id="capital" class="invalid">A <b>capital (uppercase)</b> letter</p>
                                        <p id="number" class="invalid">A <b>number</b></p>
                                        <p id="length" class="invalid">Minimum <b>6 characters</b></p>
                                    </div>
                                    <div style="width: 80%; margin-left:10%" id="confirmMessage">
                                        <p id="confirmation" class="invalid"><span id="confirmationMessage">Unmatch password</span></p>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-user btn-block">
                                    Register Account</button>
                                </a>
                                <hr>
                                <!--<a href="index.html" class="btn btn-google btn-user btn-block">
                                    <i class="fab fa-google fa-fw"></i> Register with Google
                                </a>
                                <a href="index.html" class="btn btn-facebook btn-user btn-block">
                                    <i class="fab fa-facebook-f fa-fw"></i> Register with Facebook
                                </a>-->
                            </form>
                            <hr>
                            <div class="text-center">
                                <a class="small" href="{{path('sopay_forgot_password')}}">Forgot Password?</a>
                            </div>
                            <div class="text-center">
                                <a class="small" href="{{ path('sopay_login')}}">Already have an account? Login!</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}
{% block script %}
    <script>
        $(document).ready(function(){
            $('#register').on('submit', function(e){
                e.preventDefault();
                //verif if form contain an error
                if($('form').find('p').hasClass('invalid')){
                    $('#errorTag').text('please feel a correct password').attr('style', 'border-color:red; color:red;').show();
                    return false;
                }
                let username = $('#username').val();
                let email = $('#email').val();
                let contact = $('#contact').val();
                let password = $('#password').val();
                let typeUser = $('#typeUser').val();
                $.ajax({
                    url: "{{ path('sopay_register') }}",
                    type: "POST",
                    dataType: "JSON",
                    data: {username: username,
                           password: password,
                            contact: contact,
                            email: email,
                            type: typeUser,
                            uuid: localStorage.uuid,
                            os: navigator.platform,
                            br: navigator.appCodeName
                          },
                    success:function(data)
                     {
                        $('#errorTag').text(data.message).attr('style', 'border-color:red; color:red;').show();
                        if(data.success == true){
                            $('#errorTag').attr('style', 'color:green;');
                            setTimeout(function(){ window.location.href = "{{ path('sopay_login') }}"; }, 5000);
                        }
                        console.log(data);
                    },
                   error: function(err){
                    console.log(err);
                   }
                 });
            });
        });
    </script>
    <script>
        var myInput = document.getElementById("password");
        var confirmInput = document.getElementById("passConfirm");
        var letter = document.getElementById("letter");
        var capital = document.getElementById("capital");
        var number = document.getElementById("number");
        var length = document.getElementById("length");
        var confirmation = document.getElementById("confirmation");
        
        // When the user clicks on the password field, show the message box
        myInput.onfocus = function() {
          document.getElementById("message").style.display = "block";
        }
        
        // When the user clicks outside of the password field, hide the message box
        myInput.onblur = function() {
          document.getElementById("message").style.display = "none";
        }
        
        // When the user starts to type something inside the password field
        myInput.onkeyup = function() {
          // Validate lowercase letters
          var lowerCaseLetters = /[a-z]/g;
          if(myInput.value.match(lowerCaseLetters)) {
            letter.classList.remove("invalid");
            letter.classList.add("valid");
          } else {
            letter.classList.remove("valid");
            letter.classList.add("invalid");
        }
        
          // Validate capital letters
          var upperCaseLetters = /[A-Z]/g;
          if(myInput.value.match(upperCaseLetters)) {
            capital.classList.remove("invalid");
            capital.classList.add("valid");
          } else {
            capital.classList.remove("valid");
            capital.classList.add("invalid");
          }
        
          // Validate numbers
          var numbers = /[0-9]/g;
          if(myInput.value.match(numbers)) {
            number.classList.remove("invalid");
            number.classList.add("valid");
          } else {
            number.classList.remove("valid");
            number.classList.add("invalid");
          }
        
          // Validate length
          if(myInput.value.length >= 6) {
            length.classList.remove("invalid");
            length.classList.add("valid");
          } else {
            length.classList.remove("valid");
            length.classList.add("invalid");
          }
         
        }

          // When the user clicks on the confirmation password field, show the message box
          confirmInput.onfocus = function() {
            document.getElementById("confirmMessage").style.display = "block";
          }
          
          // When the user clicks outside of the password field, hide the message box
          confirmInput.onblur = function() {
            document.getElementById("confirmMessage").style.display = "none";
          }
          
          // When the user starts to type something inside the password field
          confirmInput.onkeyup = function() {
             // Validate confirmation
          if(myInput.value === confirmInput.value) {
            confirmation.classList.remove("invalid");
            confirmation.classList.add("valid");
            $('#confirmationMessage').text('Valid Password');
          } else {
            confirmation.classList.remove("valid");
            confirmation.classList.add("invalid");
            $('#confirmationMessage').text('Unmatch password');
          }
        }
        </script>
{% endblock %}
