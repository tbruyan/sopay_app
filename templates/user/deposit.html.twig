<div class="d-sm-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 mb-0 text-gray-800">{{'Credit your Account'|trans}}</h1>
  <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
    class="fas fa-download fa-sm text-white-50"></i> <span id='rate'></span></a>
  </div>
  <div class="row justify-content-center" id="content"> 
  <form method="post" class="align-items-center justify-content-center" style="min-height:300px; margin:50px">
    <div id='paymentMethods'>
      {% if error is defined %}
            <div class="alert alert-danger">{{ error.messageKey|trans(error.messageData, 'security') }}</div>
            {% endif %}
        <div><span class="d-flex d-sm-flex justify-content-center justify-content-sm-center" style="font-size: 18px; margin-bottom: 10px">{{'Select payment methods'|trans}} ?</span></div>
        
        <div class="d-block d-md-flex flex-column justify-content-center" style="min-height: 300px; margin-top:20px">
          <div class="d-block d-md-flex  justify-content-between">  
          <div class="form-check" style="height: 150px; width:150px">
              <label class="form-check-label"> <input class="form-check-input" type="radio" name="service" value="om" ><img class="img-fluid" src="{{ asset('assets/img/om.jpg') }}" style="cursor:pointer"></label>
            </div>
            <div class="form-check" style="height: 150px; width:150px">
            <label class="form-check-label"><input class="form-check-input" type="radio" name="service" value="eum"><img class="img-fluid" src="{{ asset('assets/img/eu.png') }}" style="cursor:pointer"></label>
          </div>
          <div class="form-check" style="height: 150px; width:150px">
            <label class="form-check-label"><input class="form-check-input" type="radio" name="service" value="pm"><img class="img-fluid" src="{{ asset('assets/img/pm.jpeg') }}" style="cursor:pointer"></label>
          </div>
          <div class="form-check" style="height: 150px; width:150px">
            <label class="form-check-label"><input class="form-check-input" type="radio" name="service" value="etherum"  required="required"><img class="img-fluid" src="{{ asset('assets/img/ether.png') }}" style="cursor:pointer"></label>
          </div>
        </div>
            <div class="d-block d-md-flex justify-content-between">
              <div class="form-check" style="height: 150px; width:150px">
                <label class="form-check-label"><input class="form-check-input" type="radio" name="service" value="litecoin" ><img class="img-fluid" src="{{ asset('assets/img/litecoin.png') }}" style="cursor:pointer"></label></div>  
              <div class="form-check" style="height: 150px; width:150px">
                <label class="form-check-label"><input class="form-check-input" type="radio" name="service" value="ripple"  required="required"><img class="img-fluid" src="{{ asset('assets/img/ripple2.jpg') }}" style="cursor:pointer"></label>
              </div>
                <div class="form-check" style="height: 150px; width:150px">
                <label class="form-check-label"><input class="form-check-input" type="radio" name="service" value="doge" ><img class="img-fluid" src="{{ asset('assets/img/doge.png') }}" style="cursor:pointer"></label></div>
                </div>
                <div class="d-block d-md-flex justify-content-between">
                  <div class="form-check" style="height: 150px; width:150px">
                      <label class="form-check-label"><input class="form-check-input" type="radio" name="service" value="momo"  required="required"><img class="img-fluid" src="{{ asset('assets/img/momo.jpg') }}" style="cursor:pointer"></label>
                    </div>
                    <div class="form-check" style="height: 150px; width:150px">
                    <label class="form-check-label"><input class="form-check-input" type="radio" name="service" value="paypal" ><img class="img-fluid" src="{{ asset('assets/img/paypal.png') }}" style="cursor:pointer"></label></div>
                    <div class="form-check" style="height: 150px; width:150px">
                      <label class="form-check-label"><input class="form-check-input" type="radio" name="service" value="bitcoin" ><img class="img-fluid" src="{{ asset('assets/img/btc.png') }}" style="cursor:pointer"></label></div>  
                    </div>
          </div>
        <div class="d-flex justify-content-center" ><button class="btn btn-primary btn-block" type="button" id='next'>{{'Next'|trans}}</button></div> 
                   
    </div>

      <div id="otherMethods" style="display: none">
      <div><span class="d-flex d-sm-flex justify-content-center justify-content-sm-center" style="font-size: 18px; margin-bottom: 10px">{{'Choose one of other payment methods'|trans}} ?</span></div>
        <div style="margin-bottom: 20px" ><button class="btn btn-light btn-block" id="btc" type="submit" style="background-size: cover;  background-repeat :no-repeat; background-position:center; height: 50px; margin-bottom: 10px;background-image: url()"></button></div>
      </div>
    

    <div id="processPay" style="display: none ; " class="justify-content-center">
        <div class="justify-content-between" id="processOm" style="display: none">
            <div style="margin-bottom: 20px; max-height: 100px; max-width:100px"><img class="img-fluid" src="{{ asset('assets/img/om.jpg') }}" style="cursor:pointer"></div>
            <div><span style="font-size: 1.2em; margin-top: 10px; margin-bottom: 30px">{{'feel your Orange money wallet'|trans }}</span></div>
        </div>
        <div class="justify-content-between" id="processEum" style="display: none">
          <div style="margin-bottom: 20px; max-height: 100px; max-width:100px"><img class="img-fluid" src="{{ asset('assets/img/eu.jpg') }}" style="cursor:pointer"></div>
            <div><span style="font-size: 1.2em; margin-top: 10px; margin-bottom: 30px">{{'feel your Express Union mobile money wallet'|trans }}</span></div>
        </div>
        <div class="justify-content-between" id="processMomo" style="display: none">
          <div style="margin-bottom: 20px; max-height: 100px; max-width:100px"><img class="img-fluid" src="{{ asset('assets/img/momo.jpg') }}" style="cursor:pointer"></div>
            <div><span style="font-size: 1.2em; margin-top: 10px; margin-bottom: 30px">{{'feel your MTN mobile money wallet'|trans }}</span></div>
        </div>
        <div class="justify-content-between" id="processPaypal" style="display: none">
          <div style="margin-bottom: 20px; max-height: 100px; max-width:100px"><img class="img-fluid" src="{{ asset('assets/img/paypal.png') }}" style="cursor:pointer"></div>
          <div id="blocPaypal"><span style="font-size: 1.2em; margin-top: 10px; margin-bottom: 30px">{{'Just feel the deposit amount in USD'|trans }}</span></div>
          <div class="col justify-content-between" id="ppal">
          </div>
        </div>
        <div class="justify-content-between" id="processPm" style="display: none">
          <div style="margin-bottom: 20px; max-height: 100px; max-width:100px"><img class="img-fluid" src="{{ asset('assets/img/pm.jpeg') }}" style="cursor:pointer"></div>
          <div><span style="font-size: 1.2em; margin-top: 10px; margin-bottom: 30px">{{'Just feel the deposit amount in USD'|trans }}</span></div>
          
        </div>
        </div>
          <div class="justify-content-between" id="processBtc" style="display: none">
            <div style="margin-bottom: 20px; max-height: 100px; max-width:100px"><img class="img-fluid" src="{{ asset('assets/img/btc.png') }}" style="cursor:pointer"></div>
            <div id="blocBtc"><span style="font-size: 1.2em; margin-top: 10px; margin-bottom: 30px">{{'Just feel the deposit amount in USD'|trans }}</span></div>
      </div>
    

    <div id='askConfirmation' style="display: none">
        <h3 style="text-align: center; margin-bottom: 20px">{{'confirm credit'|trans}}</h3>
        <div id="localService">
          <div>
              <span>{{'Pease check your phone to confirm transaction through :'|trans}}</span>
          </div>
          <div class="col d-none justify-content-between" id="momo">
            <div class="form-check" style="padding: 5px; height: 150px; width:150px;" >
              <img class="img-fluid" src="{{ asset('assets/img/momo.jpg') }}" style="cursor:pointer">
            </div>
              <span style="font-size: 1.2em; margin-top: 15px">*126#</span>
          </div>
          <div class="col d-none justify-content-between" id="om">
          <div class="form-check" style="padding: 5px; height: 150px; width:150px;" >
              <img class="img-fluid" src="{{ asset('assets/img/om.jpg') }}" style="cursor:pointer">
              </div>
              <span style="font-size: 1.2em; margin-top: 30px">#150*50#</span>
          </div>
          <div class="col d-none justify-content-between" id="eum">
            <div class="form-check" style="padding: 5px; height: 150px; width:150px;" >
                <img class="img-fluid" src="{{ asset('assets/img/eu.jpg') }}" style="cursor:pointer">
                </div>
                <span style="font-size: 1.2em; margin-top: 30px">#150*50#</span>
            </div>
        </div>
        <div class="col d-none flex-column justify-content-between" id="bitcoin">
        <div class="col d-none justify-content-between" id="checkWallet">
        <div class="form-check" style="padding: 5px; height: 150px; width:150px;" >
            <img class="img-fluid" src="{{ asset('assets/img/bitcoin.jpg') }}" style="cursor:pointer">
            </div>
            <span style="font-size: 1.2em; margin-top: 30px">{{'please wait...'|trans}}</span>
        </div>
        <div class="d-none" id="resultWallet" style="margin-left: -20px">
            <h6 style="font-size: 1.1em; text-align: center;">{{'MAKE TRANSFERT TO THIS WALLET'|trans}}</h6>
            <div style="text-align: center;"><img id="qrCodeBtc"/></div>
            <div>
              <span id="wallet" style="font-size: 0.8em"></span>
            </div>
            <div>
              <span >{{'Amount to send in BTC :'|trans}} </span><span id="btcValue" style="color: rgb(255,0,0); text-decoration: underline;"></span><br />
              <span >{{'Value in XPI :'|trans}} </span><span id="xpiValue" style="color: rgb(255,0,0); text-decoration: underline;"></span>
            </div>
        </div>
      </div>
      
      <div class="form-group" id="loader"><button class="btn btn-primary btn-block" type="button" style="background-image :url('{{ asset("assets/img/loading.gif") }}'); background-repeat :no-repeat; background-position:center;height: 46px"></button>
      </div>
    </div>
    <div id='confirmSms' style='display: none'>
    <h3 style="text-align: center; margin-bottom: 20px">{{'confirm credit'|trans}}</h3>
    <div id="localService2">
    <div>
        <span>{{'Feel the security code you receive through SMS by DOHONE'|trans}}</span>
    </div>
    </div>
    <div class='form-group'><input class='form-control' type='text' name='smsCode' id="smsCode" placeholder="{{'Confirmation code'|trans}}" ></div>
    <div class="form-group" ><button class="btn btn-primary btn-block" id="submitSms" type="button">{{'Send'|trans}}</button>
      <button class="btn btn-primary btn-block" id="loader2" type="button" style="display: none; background-image :url('{{ asset("assets/img/loading.gif") }}'); background-repeat :no-repeat; background-position:center;height: 46px"></button>
    </div>
    </div>

  </form>
</div>
<script type="text/javascript">
$(document).ready(function(){
  window.history.pushState("", "", '#credit-account');
//CONTACT API PAIEMENT
var service;
var usdValue;
var xafValue ;
var number;
var amount;
var payId;
var ref;
//VALEUR ACTUELLE DU JETON XPI
$.ajax({
     url: "https://soleaspay.com/convert",
     type: "GET",
     dataType: "JSON",
     data: {amount: '1',
            devise: 'XPI'},
     success:function(data)
      {
       	xafValue = parseInt(data.data.XAF);
        usdValue = data.data.USD;
        $('#rate').text('1 XPI = '+xafValue+' FCFA');
      }
  });
  
$("input[name='service']").on('click', function(){
    service = this.value;
});

$('#next').on('click', function(){
  if(service == null){
    alert('select one payment method');
  }else if(service == 'other'){
    $('#rate').text('1 XPI = '+usdValue+' USD');
    service =  'bitcoin';
    $('#paymentMethods').fadeOut();
    //$('#ppal').attr('class', 'd-flex');
    $('#otherMethods').fadeIn();
  }else if(service == 'paypal'){
    $('#paymentMethods').fadeOut();
    //$('#ppal2').html('');
    //$('#ppal').removeAttr('class');
    //let buttonPapal = $('#ppal').html();
    //$('#ppal2').html(buttonPapal);
    $('#ppal').attr('class', 'd-flex');
    //$('#ppal2').attr('class', 'd-flex col justify-content-between');
    $('#processPay').fadeIn();
    $('#processPaypal').fadeIn();
    $('#blocPaypal').append("<div class='form-group'><input class='form-control' type='number' name='credit' id='amount' placeholder='{{'Amount in USD'|trans}}' required autofocus></div>");
    
  }else if(service == 'bitcoin'){
    $('#paymentMethods').fadeOut();
    $('#processPay').fadeIn();
    $('#processBtc').fadeIn();
    $('#blocBtc').append("<div class='form-group'><input class='form-control' type='number' name='credit' id='amount' placeholder='{{'Amount in USD'|trans}}' required autofocus></div>");
    $('#blocBtc').append("<div class='form-group' id='btc'><button class='btn btn-primary btn-block' type='submit'>{{'Submit'|trans}}</button></div>");
  }else if(service == 'om'){
    $('#paymentMethods').fadeOut();
    $('#processPay').fadeIn();
    $('#processOm').fadeIn();
    $('#processOm').append("<input class='form-control' type='number'  id='number' placeholder='{{'Phone number'|trans}}' pattern = '6{1}[0-9]{8}' title = '{{'9 number on format 6xxxxxxxx'|trans}}' required autofocus>");
    $('#processOm').append("<div class='form-group'><input class='form-control' type='number' name='credit' id='amount' placeholder='{{'Amount in FCFA'|trans}}' required></div>");
  //  $('#processOm').append("<div class='form-group'><input class='form-control' type='number' name='otp' id='otp' placeholder='{{'OTP you receive through message'|trans}}' required></div>");
    $('#processOm').append("<div class='form-group'><button class='btn btn-primary btn-block' type='submit'>{{'Submit'|trans}}</button></div>");
  }else if(service == 'momo'){
    $('#paymentMethods').fadeOut();
    $('#processPay').fadeIn();
    $('#processMomo').fadeIn();
    $('#processMomo').append("<input class='form-control' type='number'  id='number' placeholder='{{'Phone number'|trans}}' pattern = '6{1}[0-9]{8}' title = '{{'9 number on format 6xxxxxxxx'|trans}}' required autofocus>");
    $('#processMomo').append("<div class='form-group'><input class='form-control' type='number' name='credit' id='amount' placeholder='{{'Amount in FCFA'|trans}}' required></div>");
    $('#processMomo').append("<div class='form-group'><button class='btn btn-primary btn-block' type='submit'>{{'Submit'|trans}}</button></div>");
  }else if(service == 'eum'){
    $('#paymentMethods').fadeOut();
    $('#processPay').fadeIn();
    $('#processEum').fadeIn();
    $('#processEum').append("<input class='form-control' type='number'  id='number' placeholder='{{'Phone number'|trans}}' pattern = '6{1}[0-9]{8}' title = '{{'9 number on format 6xxxxxxxx'|trans}}' required autofocus>");
    $('#processEum').append("<div class='form-group'><input class='form-control' type='number' name='credit' id='amount' placeholder='{{'Amount in FCFA'|trans}}' required></div>");
    $('#processEum').append("<div class='form-group'><button class='btn btn-primary btn-block' type='submit'>{{'Submit'|trans}}</button></div>");
  }else if(service == 'pm'){
    $('#paymentMethods').fadeOut();
    $('#processPay').fadeIn();
    $('#processPm').fadeIn();
    $('#processPm').append("<div class='form-group'><input class='form-control' type='number' name='credit' id='amount' placeholder='{{'Amount in USD'|trans}}' required autofocus></div>");
    $('#processPm').append("<div class='form-group'><button class='btn btn-primary btn-block' type='submit'>{{'Submit'|trans}}</button></div>");
  }
  
});


/*$('#btc').on('click', function(){
  service =  'bitcoin';
  $('#amount').attr('placeholder', "{{'Number of XPI to be credited'|trans}}").val('');
  $('#blocBtc').append("<div class='form-group'><button class='btn btn-primary btn-block' type='submit'>{{'Submit'|trans}}</button></div>");
});*/

$('form').on('submit', function(e){
    e.preventDefault();
    amount = $('#amount').val();
    number = $('#number').val();
    var otp = $('#otp').val();
    $('#paymentMethods').fadeOut();
    $('#otherMethods').fadeOut();
    $('#processPay').fadeOut();
    $('#askConfirmation').fadeIn();
     if(service=='om'){
        service = 2;
        $('#om').attr('class', 'd-flex').fadeIn();
     }else if(service=='momo'){
        service = 1;
        $('#momo').attr('class', 'd-flex').fadeIn();
     }else if(service=='bitcoin'){
        service = 3;
        number = 1111;
        $('#localService').fadeOut();
        $('#bitcoin').attr('class', 'd-flex').fadeIn();
        $('#checkWallet').attr('class', 'd-flex').fadeIn();
     }else if(service=='eum'){
        service = 5;
        $('#eum').attr('class', 'd-flex').fadeIn();
      }else if(service=='pm'){
        service = 8;
        $('#localService').fadeOut();
        $('#pm').attr('class', 'd-flex').fadeIn();
      }
     $.ajax({
     url: "{{ path('sopay_deposit') }}",
     type: "POST",
     dataType: "JSON",
     data: {amount: amount,
            wallet: number,
            service: service,
            otp: otp},
     success:function(data)
      { 
        if(service==3){
          let wallet = data.data.wallet;
          let value = data.data.value;
          payId = data.data.payId;
          let xpiValue;
          $('#wallet').text(wallet);
          $('#btcValue').text(value);
          $.ajax({
             url: "https://soleaspay.com/convert",
             type: "GET",
             dataType: "JSON",
             data: {amount: amount,
                    devise: 'USD'},
             success:function(data)
              {
                xpiValue = data.data.value;
                $('#xpiValue').text(xpiValue);
              }
          });
          //$('#qrCodeBtc').attr('src', 'https://chart.googleapis.com/chart?chs=250x250&cht=qr&ch1='+wallet+'&choe=UTF-8');
          $('#qrCodeBtc').attr('src', 'https://blockchain.info/qr?data='+wallet+'&size=225');
          $('#checkWallet').attr('class', 'd-none').fadeOut();
          $('#resultWallet').attr('class', 'd-flex flex-column').fadeIn();
          $('#loader').fadeOut();
        
        }else if(service==8){
          //$('#pmAmount').val(amount);
          //$('#payId').val(data.data.payId);
          window.open('https://app.soleaspay.com/pm-payment?amount='+amount+'&ref='+data.data.payId, 'newwindow', 'width=900, height=800');
          alert('VEILLEZ POURSUIVRE LE TRANSFERT DANS LA NOUVELLE PAGE');
          setTimeout(function(){ location.reload(); }, 1000);
        
        }else if(service==1 || service==2 || service==5){
          if(data.success == true){
            if(data.message == 'Confirm new user with receive sms code'){
              $('#askConfirmation').fadeOut();
              $('#confirmSms').fadeIn();
            }else{
            $('#askConfirmation').fadeOut();
            $('#paymentMethods').fadeIn();
            $.ajax({
               url: "{#{ path('xpiment_get_balance') }#}",
               type: "POST",
               dataType: "JSON",
               success:function(data){
               //$('.balance').text(data);
               }
              });
              alert(data.message);
              setTimeout(function(){ location.reload(); }, 1000);
                        
              
            }
           }else{
        		  alert('error during transaction');
        		    $('#askConfirmation').fadeOut();
        			$('#paymentMethods').fadeIn();
              }
            }
          
      }
  });
});

$('#submitSms').on('click', function(){
  $('#submitSms').fadeOut();
  $('#loader2').fadeIn();
  var smsCode = $('#smsCode').val();
  if(smsCode == ''){
    alert('please feel the correct code');
  }else{
    $.ajax({
     url: "{#{ path('xpiment_confirm_sms') }#}",
     type: "POST",
     dataType: "JSON",
     data: {smsCode: smsCode,
            number: number,
            amount: amount
            },
     success:function(data){
      if(data.status == "credit success")
      {
        //ref = data.ref;
        //verifPay(payId, amount, ref);
        alert('Credit success');
        $('#confirmSms').fadeOut();
        $('#paymentMethods').fadeIn();
        $.ajax({
           url: "{#{ path('xpiment_get_balance') }#}",
           type: "POST",
           dataType: "JSON",
           success:function(data){
           $('.balance').text(data);
           }
        });
        location,reload();
      }else{
        alert('error during transaction');
        $('#askConfirmation').fadeOut();
        $('#paymentMethods').fadeIn();
      }
      $('#loader2').fadeOut();
      }
  });
  }
});
function verifPay(payId, amount, ref)
{
  $.ajax({
     url: "{#{ path('xpiment_verif_pay') }#}",
     type: "POST",
     dataType: "JSON",
     data: {payId: payId,
            amount: amount,
            ref: ref
            },
     success:function(data){
        $('#confirmSms').fadeOut();
        $('#paymentMethods').fadeIn();
      if(data === 'OK'){
        alert('account credit successfully');
      }else{
        alert('payment not submited');
      }
      }
  });
}

paypal.Buttons({
  createOrder: function(data, actions){
    return actions.order.create({
      purchase_units: [{
        amount: {
          value: $('#amount').val()
        }
      }]
    });
  },
  onApprove: function(data, actions){
    return actions.order.capture().then(function(details){
      $.ajax({
         url: "{{ path('sopay_deposit') }}",
         type: "POST",
         dataType: "JSON",
         data: {amount: amount,
                wallet: number,
                service: service,
                otp: details.payer.name.given_name},
         success:function(data)
          {
            //alert('transaction succeed '+ details.payer.name.given_name + ' amount : ' + data['amount']);
            alert(data.message);
          }
      }); 
    });
  }
}).render('#ppal');
});
</script>